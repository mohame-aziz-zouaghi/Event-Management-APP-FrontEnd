<div class="reservations-page">
  <h2>Manage Reservations</h2>

  <!-- Filters -->
  <div class="filters d-flex gap-2 mb-3 align-items-center">
    <input
      type="text"
      placeholder="Search by username or event"
      [(ngModel)]="searchQuery"
      (input)="applyFilters()"
    />

    <!-- Status filter -->
    <select [(ngModel)]="selectedStatus" (change)="applyFilters()">
      <option value="">All Status</option>
      <option value="CONFIRMED">Confirmed</option>
      <option value="PENDING">Pending</option>
      <option value="CANCELLED">Cancelled</option>
    </select>

    <!-- Day filter -->
    <input
      type="number"
      min="1"
      max="31"
      placeholder="Day"
      [(ngModel)]="selectedDay"
      (input)="applyFilters()"
    />

    <!-- Month filter -->
    <input
      type="number"
      min="1"
      max="12"
      placeholder="Month"
      [(ngModel)]="selectedMonth"
      (input)="applyFilters()"
    />

    <!-- Year filter -->
    <input
      type="number"
      min="2000"
      max="2100"
      placeholder="Year"
      [(ngModel)]="selectedYear"
      (input)="applyFilters()"
    />

    <!-- Reset button -->
    <button
      class="reset-btn"
      (click)="resetFilters()"
      [disabled]="!filtersTouched"
    >
      <i class="fa-solid fa-filter-circle-xmark"></i>
    </button>
  </div>

  <!-- Loading -->
  <p *ngIf="loading">Loading reservations...</p>

  <!-- No reservations -->
  <p *ngIf="!loading && filteredReservations.length === 0">
    No reservations found.
  </p>

  <!-- Reservation table -->
  <div class="table-responsive" *ngIf="filteredReservations.length > 0">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>#</th>
          <th>Username</th>
          <th>Event</th>
          <th>Date</th>
          <th>Status</th>
          <th>Ticket #</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of filteredReservations; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ r.username }}</td>
          <td>{{ r.eventtitle }}</td>
          <td>{{ r.reservationDate | date : "medium" }}</td>
          <td
            [ngClass]="{
              'active-status': r.status === 'Active',
              'cancelled-status': r.status === 'Cancelled'
            }"
          >
            {{ r.status }}
          </td>
          <td>{{ r.ticketNumber }}</td>
          <td class="reservation-actions">
            <!-- Confirm -->
            <button
              class="btn-action confirm"
              (click)="confirmReservation(r)"
              [disabled]="r.status === 'CONFIRMED' || r.status === 'CANCELLED'"
            >
              <i class="fa-solid fa-circle-check"></i>
            </button>

            <!-- Cancel -->
            <button
              class="btn-action cancel"
              (click)="cancelReservation(r)"
              [disabled]="r.status === 'CANCELLED'"
            >
              <i class="fa-solid fa-circle-xmark"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
